var d={INIT:"antetype.init",CLOSE:"antetype.close",DRAW:"antetype.draw",CALC:"antetype.calc",RECALC_FINISHED:"antetype.recalc.finished",MODULES:"antetype.modules",SETTINGS:"antetype.settings.definition",TYPE_DEFINITION:"antetype.layer.type.definition",FONTS_LOADED:"antetype.font.loaded",CANVAS_CHANGE:"antetype.canvas.change"};var l=class{herald;constructor(e){this.herald=e}async loadModules(e){let n={},o=new CustomEvent(d.MODULES,{detail:{registration:{}}});await this.herald.dispatch(o);let i=o.detail.registration;for(let t of e){if(!i[t])throw new Error("Module "+t+" is not present! Cannot instantiate the Antetype.");n[t]=i[t]}return this.load(this.orderModules(n))}async load(e){let n={};return(await Promise.all(e.reduce((i,t)=>(i.push(new Promise(r=>{t.load().then(s=>{r({name:t.name,init:s})})})),i),[]))).forEach(i=>{n[i.name]=i.init(n)}),n}orderModules(e){let n=[],o={},i=Object.keys(e).length*2;for(;!this.isObjectEmpty(e);){if(i--,i<0)throw console.warn("Not registered in load groups",e),new Error("Infinite dependency detected, stopping script...");e:for(let t in e){let r=e[t],s=r.requires??[];for(let a of s){if(!o[a]&&!e[a])throw new Error("Module "+t+" is requesting not present dependency: "+a);if(e[a])continue e}n.push({...r,name:t}),delete e[t],o[t]=!0}}return n}isObjectEmpty(e){for(let n in e)if(Object.prototype.hasOwnProperty.call(e,n))return!1;return!0}};export{l as default};
