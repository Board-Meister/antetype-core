var d={INIT:"antetype.init",CLOSE:"antetype.close",DRAW:"antetype.draw",CALC:"antetype.calc",RECALC_FINISHED:"antetype.recalc.finished",MODULES:"antetype.modules",SETTINGS:"antetype.settings.definition",TYPE_DEFINITION:"antetype.layer.type.definition",FONTS_LOADED:"antetype.font.loaded"};var l=class{herald;constructor(e){this.herald=e}async loadModules(e,o){let i={},r=new CustomEvent(d.MODULES,{detail:{registration:{}}});await this.herald.dispatch(r);let t=r.detail.registration;for(let n of e){if(!t[n])throw new Error("Module "+n+" is not present! Cannot instantiate the Antetype.");i[n]=t[n]}return this.load(o,this.orderModules(i))}async load(e,o){let i={};return(await Promise.all(o.reduce((t,n)=>(t.push(new Promise(s=>{n.load().then(a=>{s({name:n.name,init:a})})})),t),[]))).forEach(t=>{i[t.name]=t.init(i,e)}),i}orderModules(e){let o=[],i={},r=Object.keys(e).length*2;for(;!this.isObjectEmpty(e);){if(r--,r<0)throw console.warn("Not registered in load groups",e),new Error("Infinite dependency detected, stopping script...");e:for(let t in e){let n=e[t],s=n.requires??[];for(let a of s){if(!i[a]&&!e[a])throw new Error("Module "+t+" is requesting not present dependency: "+a);if(e[a])continue e}o.push({...n,name:t}),delete e[t],i[t]=!0}}return o}isObjectEmpty(e){for(let o in e)if(Object.prototype.hasOwnProperty.call(e,o))return!1;return!0}};export{l as default};
