var i=(e=>(e.STRUCTURE="antetype.structure",e.MIDDLE="antetype.structure.middle",e.BAR_BOTTOM="antetype.structure.bar.bottom",e.CENTER="antetype.structure.center",e.COLUMN_LEFT="antetype.structure.column.left",e.COLUMN_RIGHT="antetype.structure.column.right",e.BAR_TOP="antetype.structure.bar.top",e.MODULES="antetype.modules",e.ACTIONS="antetype.structure.column.left.actions",e.PROPERTIES="antetype.structure.column.left.properties",e.SHOW_PROPERTIES="antetype.structure.column.left.properties.show",e))(i||{});var c=(r=>(r.INIT="antetype.init",r.CLOSE="antetype.close",r.DRAW="antetype.draw",r.CALC="antetype.calc",r))(c||{}),s=class{#t;#r=null;#e=null;static inject={minstrel:"boardmeister/minstrel",herald:"boardmeister/herald"};inject(t){this.#t=t}async#n(t,n){if(!this.#e){let o=this.#t.minstrel.getResourceUrl(this,"core.js");this.#r=(await import(o)).default,this.#e=this.#r({canvas:n,modules:t,injected:this.#t})}return this.#e}async register(t){let{modules:n,canvas:o}=t.detail;n.core=await this.#n(n,o)}async init(t){if(!this.#e)throw new Error("Instance not loaded, trigger registration event first");let{base:n,settings:o}=t.detail;for(let a in o)this.#e.setting.set(a,o[a]);let r=this.#e.meta.document;r.base=n;let l=[];return(this.#e.setting.get("fonts")??[]).forEach(a=>{l.push(this.#e.font.load(a))}),await Promise.all(l),r.layout=await this.#e.view.recalculate(r,r.base),await this.#e.view.redraw(r.layout),r}async cloneDefinitions(t){if(!this.#e)throw new Error("Instance not loaded, trigger registration event first");t.detail.element!==null&&(t.detail.element=await this.#e.clone.definitions(t.detail.element))}static subscriptions={[i.MODULES]:"register","antetype.init":"init","antetype.calc":[{method:"cloneDefinitions",priority:-255}]}},u=s,f=u;export{s as AntetypeCore,c as Event,f as default};
